{% extends "base.html" %}

{% block content %}
<main id="step">
    <h1>Telegram MCP Setup</h1>
    <p class="muted">Choose how to set up your Telegram session.</p>

    <div class="option-buttons" role="group" aria-label="Setup options">
        <button type="button" data-form="new-session" aria-expanded="false" aria-controls="new-session-form">
            Create New Session
        </button>
        <button type="button" data-form="reauthorize" aria-expanded="false" aria-controls="reauthorize-form">
            Reauthorize Existing Session
        </button>
        <button type="button" data-form="delete-session" aria-expanded="false" aria-controls="delete-session-form">
            Delete Session
        </button>
    </div>

    <section id="new-session-form" class="setup-form" hidden aria-labelledby="new-session-heading">
        <h2 id="new-session-heading">Create New Session</h2>
        <p class="muted">Enter your phone number to authenticate with Telegram.</p>

        <form hx-post="/setup/phone" hx-target="#step" hx-swap="innerHTML">
            <label for="phone">Phone number</label>
            <input id="phone" name="phone" type="tel" placeholder="+1234567890" required />
            <button type="submit">Send Code</button>
        </form>
    </section>

    <section id="reauthorize-form" class="setup-form" hidden aria-labelledby="reauthorize-heading">
        <h2 id="reauthorize-heading">Reauthorize Existing Session</h2>
        <p class="muted">Enter your existing bearer token to reauthorize your session.</p>

        <form hx-post="/setup/reauthorize" hx-target="#step" hx-swap="innerHTML">
            <label for="token">Bearer Token</label>
            <input id="token" name="token" type="text" placeholder="Your bearer token" required />
            <button type="submit">Check & Reauthorize</button>
        </form>
    </section>

    <section id="delete-session-form" class="setup-form" hidden aria-labelledby="delete-session-heading">
        {% include "fragments/delete_form.html" %}
    </section>
</main>

<style>
    .setup-form {
        margin-top: 2rem;
    }

    /* Enhanced button interactions */
    .option-buttons button {
        position: relative;
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }

    .option-buttons button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .option-buttons button:focus {
        outline: 2px solid #4f46e5;
        outline-offset: 2px;
    }

    .option-buttons button[aria-expanded="true"] {
        border-color: #4f46e5;
        background: #1e293b;
    }

    /* Responsive design improvements */
    @media (max-width: 640px) {
        .option-buttons {
            flex-direction: column;
            gap: 0.75rem;
        }

        .option-buttons button {
            padding: 0.875rem;
            font-size: 1rem;
        }
    }
</style>

<script>
    (function () {
        'use strict';

        // Single function to handle form switching - DRY principle
        function showForm(formName) {
            const forms = ['new-session', 'reauthorize', 'delete-session'];
            const buttons = document.querySelectorAll('.option-buttons button');

            forms.forEach(name => {
                const form = document.getElementById(name + '-form');
                const button = document.querySelector(`[data-form="${name}"]`);

                if (name === formName) {
                    form.hidden = false;
                    button?.setAttribute('aria-expanded', 'true');
                } else {
                    form.hidden = true;
                    button?.setAttribute('aria-expanded', 'false');
                }
            });
        }

        // Event delegation for better performance and maintainability
        document.addEventListener('click', function (e) {
            const button = e.target.closest('[data-form]');
            if (button) {
                e.preventDefault();
                showForm(button.dataset.form);
            }
        });

        // Keyboard navigation support
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
                const button = e.target.closest('[data-form]');
                if (button) {
                    e.preventDefault();
                    showForm(button.dataset.form);
                }
            }
        });

        // Progressive enhancement: ensure forms are accessible
        document.querySelectorAll('.setup-form').forEach(form => {
            form.setAttribute('aria-live', 'polite');
        });
    })();
</script>
{% endblock %}